---
title: "726_Project"
author: "Becca Halford"
date: "2025-09-25"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, root.dir = "C:/Users/Becca/Downloads/DSCI_726_Operational_Analytics/Project")
 
# Install once (comment out after installed)
# install.packages("data.table")
# install.packages("ROCR")
# install.packages("readxl")
# install.packages("reshape2")
# install.packages("GGally")
 
library(data.table)
library(ROCR)   # if needed later
library(tidyverse)
library(dplyr)
library(readxl)
library(ggplot2)
library(reshape2)
library(GGally)

```

```{r load data}

kindle_data <- read_excel('cleaned_kindle_books.xlsx')
# Only run View() in interactive sessions
if(interactive()) {
  View(kindle_data)
}
str(kindle_data)
summary(kindle_data) #stats on the columns

```

```{r changing column type}

# Columns to convert
int_cols <- c("pages", "author_num_books", "size", "customer_reviews")

# Convert to integer
kindle_data[int_cols] <- lapply(kindle_data[int_cols], as.integer)

# checking the change
str(kindle_data[int_cols])
summary(kindle_data[int_cols])

```

```{r computing measures of location and central tendency}

# Function to calculate mode
get_mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# Select numeric columns
num_cols <- sapply(kindle_data, is.numeric)
numeric_data <- kindle_data[, num_cols]

# Create a summary table
descriptive_summary <- data.frame(
  Column = character(),
  Mean = numeric(),
  Median = numeric(),
  Mode = numeric(),
  Min = numeric(),
  Q1 = numeric(),
  Q3 = numeric(),
  Max = numeric(),
  Range = numeric(),
  Variance = numeric(),
  SD = numeric(),
  IQR = numeric(),
  stringsAsFactors = FALSE
)

# Loop through numeric columns and compute all stats
for (col in names(numeric_data)) {
  x <- numeric_data[[col]]
  descriptive_summary <- rbind(descriptive_summary, data.frame(
    Column = col,
    Mean = mean(x, na.rm = TRUE),
    Median = median(x, na.rm = TRUE),
    Mode = get_mode(x),
    Min = min(x, na.rm = TRUE),
    Q1 = quantile(x, 0.25, na.rm = TRUE),
    Q3 = quantile(x, 0.75, na.rm = TRUE),
    Max = max(x, na.rm = TRUE),
    Range = diff(range(x, na.rm = TRUE)),
    Variance = var(x, na.rm = TRUE),
    SD = sd(x, na.rm = TRUE),
    IQR = IQR(x, na.rm = TRUE)
  ))
}

# View the full descriptive statistics table
print(descriptive_summary)

```

```{r distribution_charts, fig.width=7, fig.height=5}

# Identify numeric columns
num_cols <- sapply(kindle_data, is.numeric)
numeric_data <- kindle_data[, num_cols]

# Loop through each numeric column
for (col in names(numeric_data)) {
  
  # Convert column name to symbol for tidy evaluation
  col_sym <- rlang::sym(col)
  
  # Histogram
  p_hist <- ggplot(kindle_data, aes(x = !!col_sym)) +
    geom_histogram(fill = "skyblue", color = "black", bins = 30) +
    labs(title = paste("Histogram of", col), x = col, y = "Frequency") +
    theme_minimal()
  print(p_hist)
  
  # Density plot
  p_density <- ggplot(kindle_data, aes(x = !!col_sym)) +
    geom_density(fill = "lightgreen", alpha = 0.5) +
    labs(title = paste("Density Plot of", col), x = col, y = "Density") +
    theme_minimal()
  print(p_density)
  
  # Boxplot
  p_box <- ggplot(kindle_data, aes(y = !!col_sym)) +
    geom_boxplot(fill = "orange", color = "black") +
    labs(title = paste("Boxplot of", col), y = col) +
    theme_minimal()
  print(p_box)
}

```

```{r correlation matrix}

# Select numeric columns
num_cols <- sapply(kindle_data, is.numeric)
numeric_data <- kindle_data[, num_cols]

# Correlation matrix
cor_matrix <- cor(numeric_data, use = "pairwise.complete.obs")
print(cor_matrix)

heatmap(cor_matrix, main = "Correlation Heatmap", col = colorRampPalette(c("blue", "white", "red"))(20))

library(reshape2)

# Melt correlation matrix into long format
cor_data <- melt(cor_matrix)

ggplot(cor_data, aes(Var1, Var2, fill = value)) +
  geom_tile(color = "white") +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white",
                       midpoint = 0, limit = c(-1,1), space = "Lab",
                       name="Correlation") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  coord_fixed() +
  labs(title = "Correlation Heatmap", x = "", y = "")

ggpairs(numeric_data) +
  labs(title = "Scatterplot Matrix of Numeric Variables")

```

```{r outliers_leverage_analysis, fig.width=7, fig.height=5}


# Select numeric columns
num_cols <- sapply(kindle_data, is.numeric)
numeric_data <- kindle_data[, num_cols]

# 1. Boxplots for outlier visualization
for (col in names(numeric_data)) {
  p <- ggplot(kindle_data, aes(y = .data[[col]])) +
    geom_boxplot(fill = "orange", color = "black") +
    labs(title = paste("Boxplot of", col), y = col) +
    theme_minimal()
  print(p)
}

# 2. Identify outliers numerically using IQR method
outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  x[x < (Q1 - 1.5*IQR) | x > (Q3 + 1.5*IQR)]
}

outlier_list <- lapply(numeric_data, outliers)

# Print outliers
for (col in names(outlier_list)) {
  cat("Outliers in", col, ":\n")
  print(outlier_list[[col]])
  cat("\n")
}

# 3. High leverage points in a simple regression
# Example: predicting 'pages' from other numeric predictors
predictors <- setdiff(names(numeric_data), "pages")  # exclude target
formula <- as.formula(paste("pages ~", paste(predictors, collapse = " + ")))
lm_model <- lm(formula, data = kindle_data)

# Compute leverage
lev <- hatvalues(lm_model)
high_lev <- which(lev > 2*mean(lev))  # rule of thumb: leverage > 2*avg

cat("High leverage points (indices) for regression model:\n")
print(high_lev)

# Optional: plot residuals vs leverage
plot(lm_model, which = 5)  # Residuals vs Leverage plot



```
